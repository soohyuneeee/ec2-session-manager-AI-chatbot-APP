# EC2 ì„¸ì…˜ ë§¤ë‹ˆì € ë°±ì—”ë“œ API ë¬¸ì„œ

## ğŸ“¡ í†µì‹  ë°©ì‹
- **í”„ë¡œí† ì½œ**: WebSocket (Socket.IO)
- **í¬íŠ¸**: 3003
- **ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ **: í´ë¼ì´ì–¸íŠ¸ â†” ì„œë²„

---

## ğŸ”Œ ì—°ê²° ê´€ë¦¬

### `connection`
**ì„¤ëª…**: í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì—°ê²°ë  ë•Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸
- **ë°©í–¥**: í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„
- **ìë™ ë°œìƒ**: WebSocket ì—°ê²° ì‹œ

### `disconnect`
**ì„¤ëª…**: í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ì´ í•´ì œë  ë•Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸
- **ë°©í–¥**: í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„
- **ìë™ ë°œìƒ**: ë¸Œë¼ìš°ì € ì¢…ë£Œ, ë„¤íŠ¸ì›Œí¬ ëŠê¹€ ë“±
- **ì²˜ë¦¬**: í™œì„± ì„¸ì…˜ ì •ë¦¬, í„°ë¯¸ë„ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ

---

## ğŸ–¥ï¸ EC2 ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬

### `get-ec2-instances`
**ì„¤ëª…**: ëª¨ë“  AWS ë¦¬ì „ì˜ EC2 ì¸ìŠ¤í„´ìŠ¤ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

**ìš”ì²­**:
```javascript
socket.emit('get-ec2-instances');
```

**ì‘ë‹µ**:
```javascript
// ë¡œë”© ìƒíƒœ
socket.on('ec2-instances-loading', (data) => {
  // data: { message: 'EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¡°íšŒí•˜ê³  ìˆìŠµë‹ˆë‹¤...' }
});

// ì„±ê³µ ì‘ë‹µ
socket.on('ec2-instances-loaded', (data) => {
  // data: {
  //   instancesByRegion: {
  //     'us-east-1': [ì¸ìŠ¤í„´ìŠ¤ ë°°ì—´],
  //     'ap-northeast-2': [ì¸ìŠ¤í„´ìŠ¤ ë°°ì—´]
  //   },
  //   totalInstances: ì´_ì¸ìŠ¤í„´ìŠ¤_ìˆ˜
  // }
});

// ì˜¤ë¥˜ ì‘ë‹µ
socket.on('ec2-instances-error', (data) => {
  // data: { error: 'ì˜¤ë¥˜ ë©”ì‹œì§€' }
});
```

**ì¸ìŠ¤í„´ìŠ¤ ê°ì²´ êµ¬ì¡°**:
```javascript
{
  instanceId: 'i-1234567890abcdef0',
  name: 'ì¸ìŠ¤í„´ìŠ¤ ì´ë¦„',
  state: 'running' | 'stopped',
  instanceType: 't3.micro',
  platform: 'Linux/Unix' | 'Windows',
  platformDetails: 'Amazon Linux 2',
  architecture: 'x86_64',
  launchTime: '2023-01-01T00:00:00.000Z',
  privateIpAddress: '10.0.1.100',
  publicIpAddress: '1.2.3.4',
  vpcId: 'vpc-12345678',
  subnetId: 'subnet-12345678',
  securityGroups: [ë³´ì•ˆê·¸ë£¹_ë°°ì—´],
  keyName: 'my-key-pair',
  region: 'ap-northeast-2'
}
```

### `get-instance-actions`
**ì„¤ëª…**: íŠ¹ì • ì¸ìŠ¤í„´ìŠ¤ì˜ OSë³„ ì¶”ì²œ ì•¡ì…˜ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

**ìš”ì²­**:
```javascript
socket.emit('get-instance-actions', {
  instanceInfo: ì¸ìŠ¤í„´ìŠ¤_ê°ì²´
});
```

**ì‘ë‹µ**:
```javascript
// ì„±ê³µ ì‘ë‹µ
socket.on('instance-actions-loaded', (data) => {
  // data: {
  //   instanceInfo: ì¸ìŠ¤í„´ìŠ¤_ê°ì²´,
  //   recommendedActions: [ì•¡ì…˜_ë°°ì—´]
  // }
});

// ì˜¤ë¥˜ ì‘ë‹µ
socket.on('instance-actions-error', (data) => {
  // data: { error: 'ì˜¤ë¥˜ ë©”ì‹œì§€' }
});
```

---

## ğŸ”— ì„¸ì…˜ ê´€ë¦¬

### `start-session`
**ì„¤ëª…**: EC2 ì¸ìŠ¤í„´ìŠ¤ì— SSM ì„¸ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.

**ìš”ì²­**:
```javascript
socket.emit('start-session', {
  instanceId: 'i-1234567890abcdef0'
});
```

**ì‘ë‹µ**:
```javascript
// ì„±ê³µ ì‘ë‹µ
socket.on('session-started', (data) => {
  // data: { sessionId: 'SSM_ì„¸ì…˜_ID' }
});

// ì˜¤ë¥˜ ì‘ë‹µ
socket.on('session-error', (data) => {
  // data: { error: 'ì˜¤ë¥˜ ë©”ì‹œì§€' }
});

// ì„¸ì…˜ ì¢…ë£Œ
socket.on('session-ended', () => {
  // ì„¸ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŒì„ ì•Œë¦¼
});
```

---

## ğŸ’» í„°ë¯¸ë„ ìƒí˜¸ì‘ìš©

### `terminal-input`
**ì„¤ëª…**: í„°ë¯¸ë„ì— ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

**ìš”ì²­**:
```javascript
socket.emit('terminal-input', 'ëª…ë ¹ì–´_ë¬¸ìì—´');
```

### `terminal-output`
**ì„¤ëª…**: í„°ë¯¸ë„ ì¶œë ¥ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì‹ í•©ë‹ˆë‹¤.

**ì‘ë‹µ**:
```javascript
socket.on('terminal-output', (data) => {
  // data: í„°ë¯¸ë„_ì¶œë ¥_ë¬¸ìì—´
});
```

### `resize-terminal`
**ì„¤ëª…**: í„°ë¯¸ë„ í¬ê¸°ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤.

**ìš”ì²­**:
```javascript
socket.emit('resize-terminal', {
  cols: 80,
  rows: 24
});
```

### `analyze-command`
**ì„¤ëª…**: í„°ë¯¸ë„ ì¶œë ¥ ë¶„ì„ ê²°ê³¼ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤.

**ì‘ë‹µ**:
```javascript
socket.on('analyze-command', (data) => {
  // data: {
  //   output: 'í„°ë¯¸ë„_ì¶œë ¥',
  //   history: [ìµœê·¼_íˆìŠ¤í† ë¦¬_10ê°œ],
  //   analysis: {
  //     patterns: ['error', 'permission'],
  //     severity: 'warning',
  //     context: 'ë¶„ì„_ê²°ê³¼_ë©”ì‹œì§€'
  //   }
  // }
});
```

---

## ğŸ¤– AI ì±„íŒ… ì‹œìŠ¤í…œ

### `chat-message`
**ì„¤ëª…**: AI ì–´ì‹œìŠ¤í„´íŠ¸ì—ê²Œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.

**ìš”ì²­**:
```javascript
socket.emit('chat-message', {
  message: 'ì‚¬ìš©ì_ë©”ì‹œì§€',
  instanceInfo: ì¸ìŠ¤í„´ìŠ¤_ê°ì²´ // ì„ íƒì‚¬í•­
});
```

### `chat-response`
**ì„¤ëª…**: AI ì–´ì‹œìŠ¤í„´íŠ¸ì˜ ì‘ë‹µì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤.

**ì‘ë‹µ**:
```javascript
socket.on('chat-response', (data) => {
  // data: {
  //   message: 'AI_ì‘ë‹µ_ë©”ì‹œì§€',
  //   timestamp: '2023-01-01T00:00:00.000Z',
  //   isLoading: false,
  //   loadingType: 'analyzing' | 'executing' | 'generating',
  //   isAction: true, // ì•¡ì…˜ ì‹¤í–‰ ê´€ë ¨ ë©”ì‹œì§€ì¸ì§€
  //   isSummary: true, // ìš”ì•½ ë©”ì‹œì§€ì¸ì§€
  //   isAutoGenerated: true, // ìë™ ìƒì„±ëœ ë©”ì‹œì§€ì¸ì§€
  //   hasDynamicActions: true, // ë™ì  ì•¡ì…˜ í¬í•¨ ì—¬ë¶€
  //   dynamicActions: [ì•¡ì…˜_ë°°ì—´], // ì‹¤í–‰ ê°€ëŠ¥í•œ ì•¡ì…˜ë“¤
  //   actionContext: 'ì•¡ì…˜_ì„¤ëª…',
  //   actionId: 'ì•¡ì…˜_ID'
  // }
});
```

**ë™ì  ì•¡ì…˜ ê°ì²´ êµ¬ì¡°**:
```javascript
{
  id: 'nginx_setup',
  title: 'nginx ì„¤ì¹˜ ë° ì„¤ì •',
  description: 'nginxë¥¼ ì„¤ì¹˜í•˜ê³  ê¸°ë³¸ ì„¤ì •ì„ í•©ë‹ˆë‹¤',
  commands: [
    'sudo amazon-linux-extras install nginx1 -y',
    'sudo systemctl start nginx',
    'sudo systemctl enable nginx',
    'sudo systemctl status nginx'
  ]
}
```

---

## âš¡ ì•¡ì…˜ ì‹¤í–‰ ì‹œìŠ¤í…œ

### `execute-dynamic-action`
**ì„¤ëª…**: ë™ì ìœ¼ë¡œ ìƒì„±ëœ ì•¡ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

**ìš”ì²­**:
```javascript
socket.emit('execute-dynamic-action', {
  action: ì•¡ì…˜_ê°ì²´,
  actionId: 'ê³ ìœ _ì•¡ì…˜_ID'
});
```

### `action-button-clicked`
**ì„¤ëª…**: ì•¡ì…˜ ë²„íŠ¼ í´ë¦­ í™•ì¸ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤.

**ì‘ë‹µ**:
```javascript
socket.on('action-button-clicked', (data) => {
  // data: {
  //   actionId: 'ì•¡ì…˜_ID',
  //   timestamp: '2023-01-01T00:00:00.000Z'
  // }
});
```

---

## ğŸ”§ ë‚´ë¶€ ì„œë¹„ìŠ¤ ëª¨ë“ˆ

### EC2 ì„œë¹„ìŠ¤ (`services/ec2Service.js`)
- `getEC2InstancesByRegion()`: ëª¨ë“  ë¦¬ì „ì˜ EC2 ì¸ìŠ¤í„´ìŠ¤ ì¡°íšŒ
- `generateOSSpecificActions(instanceInfo)`: OSë³„ ì¶”ì²œ ì•¡ì…˜ ìƒì„±

### AI ì„œë¹„ìŠ¤ (`services/aiService.js`)
- `generateDynamicActions(message, history, instanceInfo)`: ë™ì  ì•¡ì…˜ ìƒì„±
- `generateAIResponse(message, history, instanceInfo)`: AI ì‘ë‹µ ìƒì„±
- `generateProblemSolution(terminalOutput, history)`: ë¬¸ì œ í•´ê²° ë°©ì•ˆ ìƒì„±

### í„°ë¯¸ë„ ë¶„ì„ê¸° (`services/terminalAnalyzer.js`)
- `analyzeTerminalOutput(output, history, socketId)`: ì‹¤ì‹œê°„ í„°ë¯¸ë„ ì¶œë ¥ ë¶„ì„
- `checkCooldown(socketId, alertType, cooldownMs)`: ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€

### ì‹¤í–‰ ì„œë¹„ìŠ¤ (`services/executionService.js`)
- `executeCommandSequence(ptyProcess, commands, socket, ...)`: ëª…ë ¹ì–´ ìˆœì°¨ ì‹¤í–‰

### ìš”ì•½ ì„œë¹„ìŠ¤ (`services/summaryService.js`)
- `generateExecutionSummary(commands, results)`: ì‹¤í–‰ ê²°ê³¼ ìš”ì•½ ìƒì„±
- `generateFollowUpActions(commands, results)`: í›„ì† ì•¡ì…˜ ì œì•ˆ

---

## ğŸ”’ ë³´ì•ˆ ë° ì¸ì¦

### í™˜ê²½ ë³€ìˆ˜
```bash
AWS_REGION=ap-northeast-2
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key
BEDROCK_REGION=us-east-1
BEDROCK_MODEL_ID=arn:aws:bedrock:us-east-1:654654492738:inference-profile/us.anthropic.claude-sonnet-4-5-20250929-v1:0
PORT=3003
```

### CORS ì„¤ì •
```javascript
cors: {
  origin: "http://localhost:3000",
  methods: ["GET", "POST"]
}
```

---

## ğŸ“Š ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬

### í™œì„± ì„¸ì…˜ êµ¬ì¡°
```javascript
activeSessions.set(socket.id, {
  ptyProcess: node_pty_í”„ë¡œì„¸ìŠ¤,
  sessionId: 'SSM_ì„¸ì…˜_ID',
  instanceId: 'i-1234567890abcdef0',
  chatHistory: [
    {
      type: 'terminal' | 'input' | 'user_chat' | 'ai_chat',
      content: 'ë‚´ìš©',
      timestamp: Date
    }
  ],
  instanceInfo: ì¸ìŠ¤í„´ìŠ¤_ê°ì²´ // ì„ íƒì‚¬í•­
});
```

---

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

### ì¿¨ë‹¤ìš´ ì‹œìŠ¤í…œ
- **ê¶Œí•œ ë¬¸ì œ**: 15ì´ˆ ì¿¨ë‹¤ìš´
- **AI ë¶„ì„**: 30ì´ˆ ì¿¨ë‹¤ìš´
- **ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€**: ì†Œì¼“ë³„ ê°œë³„ ê´€ë¦¬

### ë©”ëª¨ë¦¬ ê´€ë¦¬
- **íˆìŠ¤í† ë¦¬ ì œí•œ**: ìµœê·¼ 10ê°œ í•­ëª©ë§Œ ìœ ì§€
- **ì„¸ì…˜ ì •ë¦¬**: ì—°ê²° í•´ì œ ì‹œ ìë™ ì •ë¦¬
- **í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ**: í„°ë¯¸ë„ í”„ë¡œì„¸ìŠ¤ ìë™ ì¢…ë£Œ

---

## ğŸ”„ ì´ë²¤íŠ¸ í”Œë¡œìš° ì˜ˆì‹œ

```
1. í´ë¼ì´ì–¸íŠ¸ ì—°ê²°
   â†’ connection ì´ë²¤íŠ¸

2. EC2 ì¸ìŠ¤í„´ìŠ¤ ì¡°íšŒ
   â†’ get-ec2-instances
   â†’ ec2-instances-loading
   â†’ ec2-instances-loaded

3. ì„¸ì…˜ ì‹œì‘
   â†’ start-session
   â†’ session-started

4. í„°ë¯¸ë„ ìƒí˜¸ì‘ìš©
   â†’ terminal-input
   â†’ terminal-output
   â†’ analyze-command

5. AI ì±„íŒ…
   â†’ chat-message
   â†’ chat-response (with dynamicActions)

6. ì•¡ì…˜ ì‹¤í–‰
   â†’ execute-dynamic-action
   â†’ action-button-clicked
   â†’ chat-response (progress updates)

7. ì—°ê²° í•´ì œ
   â†’ disconnect
   â†’ ì„¸ì…˜ ì •ë¦¬
```

ì´ APIëŠ” **ì‹¤ì‹œê°„ WebSocket í†µì‹ **ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ì—¬ **ì¦‰ì‹œ ì‘ë‹µ**ê³¼ **ì–‘ë°©í–¥ ë°ì´í„° ë™ê¸°í™”**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.